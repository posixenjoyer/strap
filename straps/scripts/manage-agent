# Define a fixed location for the ssh-agent socket
SSH_AUTH_SOCK_FILE="$HOME/.ssh-agent.sock"
SSH_AGENT_PID_FILE="$HOME/.ssh-agent.pid"

# Function to start ssh-agent if not running
start_ssh_agent() {
    # Check if ssh-agent is already running
    if [ -f "$SSH_AGENT_PID_FILE" ]; then
        . "$SSH_AGENT_PID_FILE"
        # Verify the agent is still running
        if pgrep -u "$USER" | grep "$SSH_AGENT_PID" > /dev/null; then
            export SSH_AUTH_SOCK="$SSH_AUTH_SOCK_FILE"
            export SSH_AGENT_PID
            return
        fi
    fi

    # Start a new ssh-agent
    ssh-agent -a "$SSH_AUTH_SOCK_FILE" > "$SSH_AGENT_PID_FILE"
    . "$SSH_AGENT_PID_FILE"
    export SSH_AUTH_SOCK="$SSH_AUTH_SOCK_FILE"
    export SSH_AGENT_PID
    ssh-add ~/.ssh/id_ed25519_2
    # Optionally add your default key (uncomment if needed)
    # ssh-add ~/.ssh/id_rsa
}

# Call the function to ensure ssh-agent is running
start_ssh_agent
